<%= ui("input_wrapper",
    label: label,
    helper_text: helper_text,
    error_text: error_text,
    name: name,
    id: id,
    disabled: disabled,
    required: required) do %>
  <div class="relative"
       data-controller="<%= controller_name %>"
       <%= stimulus_values.map { |k, v| "data-#{k.dasherize}=\"#{ERB::Util.html_escape(v)}\"" }.join(" ").html_safe %>>

    <textarea
      id="<%= id %>"
      name="<%= name %>"
      placeholder="<%= placeholder %>"
      rows="<%= rows %>"
      class="<%= Aeros::FormBuilder::BaseComponent::INPUT_BASE_CLASSES.join(' ') %> resize-y pr-24"
      data-<%= controller_name %>-target="textarea"
      <%= 'disabled' if disabled %>
      <%= 'required' if required %>
      <% if data.any? %>
        <% data.each do |key, val| %>
          data-<%= key.to_s.dasherize %>="<%= val %>"
        <% end %>
      <% end %>
    ><%= value %></textarea>

    <%# AI Assist Button %>
    <div class="absolute <%= button_position_classes %>">
      <button type="button"
              class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              data-<%= controller_name %>-target="aiButton"
              data-action="click-><%= controller_name %>#generateAi"
              <%= 'disabled' if disabled %>>
        <span data-<%= controller_name %>-target="buttonIcon">
          <%= lucide_icon("sparkles", class: "h-4 w-4") %>
        </span>
        <span data-<%= controller_name %>-target="buttonSpinner" class="hidden">
          <%= ui("spinner", size: :xs) %>
        </span>
        <span data-<%= controller_name %>-target="buttonLabel"><%= ai_button_label %></span>
      </button>
    </div>

    <%# Streaming indicator %>
    <div class="hidden absolute bottom-2 left-2 text-xs text-gray-400 flex items-center gap-1"
         data-<%= controller_name %>-target="streamingIndicator">
      <%= ui("spinner", size: :xs) %>
      <span>Generating...</span>
    </div>
  </div>
<% end %>
