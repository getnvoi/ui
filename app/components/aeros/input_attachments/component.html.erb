<%= ui("input_wrapper",
    label: label,
    helper_text: helper_text,
    error_text: error_text,
    name: name,
    id: id,
    disabled: disabled,
    required: required) do %>
  <div class="space-y-3"
       data-controller="<%= controller_name %>"
       <%= stimulus_values.map { |k, v| "data-#{k.dasherize}=\"#{ERB::Util.html_escape(v)}\"" }.join(" ").html_safe %>>

    <%# Drop zone %>
    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-indigo-400 transition-colors cursor-pointer"
         data-<%= controller_name %>-target="dropzone"
         data-action="click-><%= controller_name %>#triggerFileInput dragover-><%= controller_name %>#onDragOver dragleave-><%= controller_name %>#onDragLeave drop-><%= controller_name %>#onDrop">
      <div class="flex flex-col items-center gap-2">
        <%= lucide_icon("upload-cloud", class: "h-8 w-8 text-gray-400") %>
        <div class="text-sm text-gray-600">
          <span class="font-medium text-indigo-600">Click to upload</span> or drag and drop
        </div>
        <div class="text-xs text-gray-500">
          <%= accept == "*/*" ? "Any file type" : accept %>
          <% if max_size %>
            (max <%= number_to_human_size(max_size) %>)
          <% end %>
        </div>
      </div>

      <%# Hidden file input %>
      <input type="file"
             class="hidden"
             multiple
             accept="<%= accept %>"
             data-<%= controller_name %>-target="fileInput"
             data-action="change-><%= controller_name %>#onFileSelect"
             <%= 'disabled' if disabled %>>
    </div>

    <%# Upload progress %>
    <div class="hidden" data-<%= controller_name %>-target="progressContainer">
      <div class="flex items-center gap-2 text-sm text-gray-600">
        <%= ui("spinner", size: :sm) %>
        <span>Uploading...</span>
        <span data-<%= controller_name %>-target="progressText">0%</span>
      </div>
      <div class="mt-1 h-1.5 bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-indigo-600 transition-all duration-300"
             style="width: 0%"
             data-<%= controller_name %>-target="progressBar"></div>
      </div>
    </div>

    <%# Preview grid (sortable) %>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"
         data-<%= controller_name %>-target="previewsContainer">
    </div>

    <%# Hidden inputs for form submission %>
    <div data-<%= controller_name %>-target="hiddenInputs">
    </div>
  </div>
<% end %>
